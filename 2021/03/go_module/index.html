<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Go_module - Jesse's Blog</title><meta name=Description content="Jesse的博客"><meta property="og:title" content="Go_module"><meta property="og:description" content="GOPATH 的前世今生 GOPATH 是布置 Go 开发环境时所设置的一个环境变量。历史版本的 go 语言开发时，需要将代码放在 GOPATH 目录的 src 文件夹下。go get 命令获取依赖，也会自动"><meta property="og:type" content="article"><meta property="og:url" content="https://www.jesse233.top/2021/03/go_module/"><meta property="og:image" content="https://www.jesse233.top/avatar.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-03-20T19:38:46+08:00"><meta property="article:modified_time" content="2021-03-20T19:38:46+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.jesse233.top/avatar.png"><meta name=twitter:title content="Go_module"><meta name=twitter:description content="GOPATH 的前世今生 GOPATH 是布置 Go 开发环境时所设置的一个环境变量。历史版本的 go 语言开发时，需要将代码放在 GOPATH 目录的 src 文件夹下。go get 命令获取依赖，也会自动"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.jesse233.top/2021/03/go_module/><link rel=prev href=https://www.jesse233.top/2021/03/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><meta name=baidu-site-verification content="yJZ8DYA9pA"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Go_module","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.jesse233.top\/2021\/03\/go_module\/"},"genre":"posts","wordcount":4664,"url":"https:\/\/www.jesse233.top\/2021\/03\/go_module\/","datePublished":"2021-03-20T19:38:46+08:00","dateModified":"2021-03-20T19:38:46+08:00","publisher":{"@type":"Organization","name":"宋志新"},"author":{"@type":"Person","name":"Jesse"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Jesse's Blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/favicon.svg data-srcset="/favicon.svg, /favicon.svg 1.5x, /favicon.svg 2x" data-sizes=auto alt=/favicon.svg title=/favicon.svg>Jesse's Blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/books>书单 </a><a class=menu-item href=/about>关于我 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Jesse's Blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/favicon.svg data-srcset="/favicon.svg, /favicon.svg 1.5x, /favicon.svg 2x" data-sizes=auto alt=/favicon.svg title=/favicon.svg>Jesse's Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/books title>书单</a><a class=menu-item href=/about title>关于我</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Go_module</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/jesse996 title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>Jesse</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-03-20>2021-03-20</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 4664 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 10 分钟&nbsp;<span id=/2021/03/go_module/ class=leancloud_visitors data-flag-title=Go_module>
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#gopath-的前世今生>GOPATH 的前世今生</a></li><li><a href=#gopath-模式不再推荐的原因>GOPATH 模式不再推荐的原因</a><ul><li><a href=#go-modules-相关环境变量>Go modules 相关环境变量</a></li><li><a href=#goproxy>GOPROXY</a></li><li><a href=#gosumdb>GOSUMDB</a></li><li><a href=#gonoproxy--gonosumdb--goprivate>GONOPROXY / GONOSUMDB / GOPRIVATE</a></li><li><a href=#go-modules-操作命令及相关文件解读>Go modules 操作命令及相关文件解读</a></li><li><a href=#go-mod-init-命令>go mod init 命令</a><ul><li><a href=#gomod-文件>go.mod 文件</a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=gopath-的前世今生>GOPATH 的前世今生</h1><p>GOPATH 是布置 Go 开发环境时所设置的一个环境变量。历史版本的 go 语言开发时，需要将代码放在 GOPATH 目录的 src 文件夹下。go get 命令获取依赖，也会自动下载到 GOPATH 的 src 下。</p><p>例如：</p><p><code>go get github.com/foo/bar</code>
会将代码下载到 <code>$GOPATH/src/github.com/foo/bar</code></p><p>可以通过命令 <code>go env</code> 获取当前设置的 GOPATH 路径。</p><p>例如我的电脑上设置如下：
<code>GOPATH="/Users/xxx/project/go"</code></p><p>GOPATH 具体结构如下，必须包含三个文件夹，具体如下图所示：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>GOPATH
├── bin //编译生成的二进制文件
├── pkg //预编译文件，以加快程序的后续编译速度
|── src //所有源代码
├── github.com
...
...
</code></pre></td></tr></table></div></div><h1 id=gopath-模式不再推荐的原因>GOPATH 模式不再推荐的原因</h1><p>最严重的问题就是，GOPATH 模式下，go get 命令使用时，没有版本选择机制，拉下来的依赖代码都会默认当前最新版本，而且如果当项目 A 和项目 B 分别依赖项目 C 的两个不兼容版本时， GOPATH 路径下只有一个版本的 C 将无法同时满足 A 和 B 的依赖需求。这可以说是一个很大的缺陷了，因而 Go1.13 起，官方就不再推荐使用 GOPATH 的模式了。</p><p>GOPATH 模式衍生出的版本管理工具的进化
随着 Go 语言使用人数的增长，依赖包的丰富，依赖版本问题尤其严重。</p><p>于是 Go 官方在 Go 1.5 的时候提出了实验性质的 vendor 机制：每个项目都可以有一个 vendor/ 目录来存放项目所需版本依赖的拷贝。</p><p>社区中基于官方给的机制，开发出了各种版本管理工具。比较流行的比如 govendor，以及之前曾被官方认定的 godep 工具等。</p><p>这些工具的思路基本都是为每个项目单独维护一份对应版本依赖的拷贝。</p><p>管理工具虽然丰富了起来，但是不同版本工具之间不兼容，无法协作，各种工具还都有学习成本。这时候 在 Go 官方扶持下成立的 dep 项目被大家认为是未来一统江湖的版本管理工具，被称作 official experiment。</p><p>dep 采用了和 Rust 的管理工具 Cargo 类似的管理模式，原理在此不深究。</p><p>没过多久，Go 社区的核心人物 rsc 提出了 vgo 方案。一时间竟然出现了两个所谓的 Go 官方的版本管理方案。最终官方采用了 vgo 方案，随着 vgo 的逐渐成熟，Go 1.11 发布了该功能，并集成到了 Go 的官方工具中，也就是当前的 Go modules。</p><h2 id=go-modules-相关环境变量>Go modules 相关环境变量</h2><p>使用 Go modules，一般涉及到如下 6 个环境变量的配置，go env 可以列出，摘录如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>GO111MODULE=&#34;auto&#34;
GOPROXY=&#34;https://goproxy.io,direct&#34;
GONOPROXY=&#34;&#34;
GOSUMDB=&#34;sum.golang.org&#34;
GONOSUMDB=&#34;&#34;
GOPRIVATE=&#34;&#34;
</code></pre></td></tr></table></div></div><p><code>GO111MODULE</code>
是开启使用 Go modules 的开关，可用参数值如下：</p><table><thead><tr><th>值</th><th>含义</th></tr></thead><tbody><tr><td>auto</td><td>在 GOPATH/src 之外，将自动使用 Go Modules 模式。否则还是用 GOPATH 模式。目前在最新的 Go1.14 中是默认值。</td></tr><tr><td>on</td><td>启用 Go modules，将不使用 GOPATH，推荐设置，将会是未来版本中的默认值。</td></tr><tr><td>off</td><td>或者不设置 Go 将使用 GOPATH 和沿用老的 vendor 机制，禁用 Go modules。不推荐设置。</td></tr></tbody></table><p>设置开启 on 的方法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>go env -w GO111MODULE=on
</code></pre></td></tr></table></div></div><p>也可在 .bash_profile 文件中直接环境变量方式设置，增加</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>export GO111MODULE=on
</code></pre></td></tr></table></div></div><h2 id=goproxy>GOPROXY</h2><p>用于设置 Go 模块代理，其作用是使 Go 在拉取模块版本时直接通过镜像站点来快速拉取默认值是这个默认地址，国内无法访问，所以开启 Go Modules 必需设置镜像代理地址</p><p>列举国内常用的镜像代理地址如下：</p><p>地址 简介
<a href=https://goproxy.io>https://goproxy.io</a> 一个全球代理为 Go 模块而生
<a href=https://mirrors.aliyun.com/goproxy/>https://mirrors.aliyun.com/goproxy/</a> 阿里镜像代理
<a href=https://goproxy.cn>https://goproxy.cn</a> 七牛云赞助支持的</p><p>GOPROXY 的值是一个以英文逗号 “,” 分割的 Go 模块代理列表，允许设置多个模块代理</p><p>不使用，可设为 “off”</p><p>默认值中有个 direct，用来告诉 Go 将直接从依赖的源地址进行下载操作（比如 GitHub 等），例如当值列表中上一个 Go 代理返回 404 或 410 时，Go 自动尝试列表中的下一个，遇见 “direct” 时回到源地址去抓取。</p><p>最终：设置代理方法一般如下：如使用七牛网代理</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>go env -w GOPROXY=https://goproxy.cn,direct
</code></pre></td></tr></table></div></div><p>也可在 .bash_profile 文件中直接环境变量方式设置，增加</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>export GOPROXY=https://goproxy.cn,direct
</code></pre></td></tr></table></div></div><h2 id=gosumdb>GOSUMDB</h2><p>Go checksum database 的缩写，含义如其名字，用于在拉取模块版本时保证拉取到的模块版本数据未经过篡改，若发现不一致，也就是可能存在篡改，将会立即中止。</p><p>GOSUMDB 的默认值为：sum.golang.org，在国内也是无法访问的，但是 GOSUMDB 可以被 Go 模块代理所代理，即设置 GOPROXY 自然就解决了。</p><p>若设置为“off”，就禁止 Go 在后续操作中校验模块版本。</p><h2 id=gonoproxy--gonosumdb--goprivate>GONOPROXY / GONOSUMDB / GOPRIVATE</h2><p>如果当前项目依赖了私有模块，则配置会涉及这三个环境变量。例如公司的私有 git 仓库，又或是 github 中的私有库，都是属于私有模块，都是要进行设置的，否则会拉取失败。简单来说就是应对，GOPROXY 设置的代理或 GOSUMDB 设定的 Go checksum database 代理无法访问模块时的情形。</p><p>建议直接设置 GOPRIVATE，它的值将作为 GONOPROXY 和 GONOSUMDB 的默认值，所以建议的最佳设置是直接使用 GOPRIVATE。</p><p>它们的值都是一个以英文逗号 “,” 分割的模块路径前缀，也就是可以设置多个，例如：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>go env -w GOPRIVATE=&#34;\*.my.com,github.com/eabc/def&#34;
</code></pre></td></tr></table></div></div><p>设置后，前缀为 *.my.com 和 github.com/eabc/def 的模块都会被认为是私有模块。</p><p>将不经过 Go module proxy 和 Go checksum database，需要注意的是不包括 my.com 本身。</p><h2 id=go-modules-操作命令及相关文件解读>Go modules 操作命令及相关文件解读</h2><p>可以命令行执行 go help mod 打印出 go mod 相关命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>download download modules to local cache 常用，下载依赖包
edit edit go.mod from tools or scripts ide 编辑就行
graph print module requirement graph 查看使用而已
init initialize new module in current directory 常用
tidy add missing and remove unused modules 常用
vendor make vendored copy of dependencies 从 mod cache 中拷贝到项目的 vendor
verify verify dependencies have expected content
why explain why packages or modules are needed
</code></pre></td></tr></table></div></div><p>接下来主要介绍 go mod init 命令，及其涉及到的必要文件</p><h2 id=go-mod-init-命令>go mod init 命令</h2><p>初始化项目，使用方法例子如下：创建个空项目之后执行如下命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>go mod init gitee.com/biexiaoyansudian/my.cn
</code></pre></td></tr></table></div></div><p>指定了模块导入路径为 gitee.com/biexiaoyansudian/my.cn</p><p>这个 init 指定的路径作用是：</p><ul><li><p>作为模块的标识（identity）</p></li><li><p>作为模块的 import path，当其他项目引用这个模块下的 package 时都会以该 import path 作为共同的前缀，比如：
import &ldquo;gitee.com/biexiaoyansudian/my.cn/mypkg&rdquo;</p></li></ul><p>go mod init 执行完毕，就初始化了使用 Go modules 的项目，会多出来一个 go.mod 文件。它记录了当前项目的模块信息，每一行都以一个关键词开头。</p><h3 id=gomod-文件>go.mod 文件</h3><p>此时，go.mod 文件内容如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>module gitee.com/biexiaoyansudian/my.cn

go 1.14
</code></pre></td></tr></table></div></div><p>Go modules 模式下，使用 go get 命令，相关信息可以自动记录到 go.mod 文件中</p><p>看如下示例：</p><p>在刚才初始化的项目中，下载 gorm 扩展包</p><p>go get -u github.com/jinzhu/gorm</p><p>默认下载最新版本，Go modules 模式下 go get 可以进行版本指定 @ 版本管理的 tag，例如</p><p>go get -u <a href=mailto:github.com/jinzhu/gorm@v1.0.0>github.com/jinzhu/gorm@v1.0.0</a></p><p>其拉取的结果缓存在 GOPATH/pkg/mod 和 GOPATH/pkg/sumdb 目录下，而在 mod 目录下会以 github.com/foo/bar 的格式进行存放。</p><p>下载完成后，go.mod 文件内容自动变更如下</p><p>module gitee.com/biexiaoyansudian/my.cn</p><p>go 1.14</p><p>require github.com/jinzhu/gorm v1.9.12 // indirect</p><p>//手动注释 indirect 标识表示该模块为间接依赖，也就是在当前应用程序中的 import 语句中，并没有发现这个模块的明确引用，如果没引用，我们提前先拉下来这个包，就会出现该注释，比如直接使用 go get 拉代码包，而不是 go build 让命令自动根据 go.mod 拉代码包</p><p>下面介绍下 go.mod 文件中可以使用到的语法关键词以及含义：</p><p>module： 定义当前项目的模块路径，不再赘述</p><p>go： 标识当前模块的 Go 语言版本，目前来看还只是个标识作用。</p><p>require： 说明 Module 需要什么版本的依赖。</p><p>exclude： 用于从使用中排除一个特定的模块版本。在实际的项目中很少被使用，故很少会显式的排除某个包的某个版本，除非我们知道某个版本有严重 bug。比如指令 exclude github.com/google/uuid v1.1.0，表示不使用 v1.1.0 版本。</p><p>场景举例：</p><p>当前项目 gitee.com/biexiaoyansudian/my.cn</p><p>下载依赖 go get <a href=mailto:github.com/google/uuid@v1.0.0>github.com/google/uuid@v1.0.0</a></p><p>my.cn 的 go.mod 文件如下</p><p>module gitee.com/biexiaoyansudian/my.cn</p><p>go 1.14</p><p>require github.com/google/uuid v1.0.0 // indirect</p><p>此时另创建项目 gitee.com/biexiaoyansudian/exclue</p><p>下载依赖 go get -uu <a href=mailto:github.com/google/uuid@v1.1.0>github.com/google/uuid@v1.1.0</a></p><p>此时如果当前 my.cn 项目想要引入 exclue 项目，可以看到 exclue 项目用的是 <a href=mailto:uuid@v1.1.0>uuid@v1.1.0</a> 大于 my.cn 项目版本，则会自动的将 my.cn 项目的也升级为 <a href=mailto:uuid@v1.1.0>uuid@v1.1.0</a></p><p>my.cn 的 go.mod 文件如下</p><p>module gitee.com/biexiaoyansudian/my.cn</p><p>go 1.14</p><p>require (
gitee.com/biexiaoyansudian/exclue v1.0.0 // indirect
github.com/google/uuid v1.1.0
)</p><p>而如果在下载 exclue 依赖之前，在 my.cn 项目的 go.mod 文件里加上</p><p>exclude github.com/google/uuid v1.1.0</p><p>此时，再去拉 exclue 项目，可以发现 uuid 直接跳过了 v1.1.0 版本升级到了 v1.1.1</p><p>my.cn 的 go.mod 文件如下</p><p>module gitee.com/biexiaoyansudian/my.cn</p><p>go 1.14</p><p>require (
gitee.com/biexiaoyansudian/exclue v1.0.0 // indirect
github.com/google/uuid v1.1.1
)</p><p>exclude github.com/google/uuid v1.1.0</p><p>replace： 替换 require 中声明的依赖，使用另外的依赖及其版本号。
首先介绍个命令，可以查看项目最终所使用的全部依赖</p><p>go list -m all</p><p>使用场景一：替换 require 的包
用例子来说明 replace 的使用场景一，一般也是最不会使用的场景。</p><p>当前项目的 go.mod 如下</p><p>module gitee.com/biexiaoyansudian/my.cn</p><p>go 1.14</p><p>require (
gitee.com/biexiaoyansudian/exclue v1.0.0 // indirect
github.com/google/uuid v1.1.1
)</p><p>exclude github.com/google/uuid v1.1.0</p><p>下执行命令 go list -m all</p><p>gitee.com/biexiaoyansudian/my.cn
gitee.com/biexiaoyansudian/exclue v1.0.0
github.com/google/uuid v1.1.1</p><p>我们在 go.mod 下增加这样一句配置</p><p>replace github.com/google/uuid v1.1.1 => github.com/google/uuid v1.1.0</p><p>再次执行命令，结果如下</p><p>gitee.com/biexiaoyansudian/my.cn
gitee.com/biexiaoyansudian/exclue v1.0.0
github.com/google/uuid v1.1.1 => github.com/google/uuid v1.1.0</p><p>发现最终生效的由 uuid v1.1.1 被替换成了 uuid v1.1.0</p><p>一般来说，这种场景使用的不多，和直接修改 require 作用相同</p><p>生效有前提条件：</p><p>一是只有在当前引用的模块有效</p><p>二是 replace 命令左侧的包名和版本，必须是 require 中包含的包名和版本</p><p>场景二：替换无法下载的包
由于网络问题，有些包无法下载，比如 golang.org 下的包，而这些包在 GitHub 都有镜像，此时就可以使用 GitHub 上的包来替换。</p><p>比如，项目中使用了 golang.org/x/text 包：</p><p>module github.com/renhongcai/gomodule</p><p>go 1.14</p><p>require (
github.com/google/uuid v1.1.1
golang.org/x/text v0.3.2
)</p><p>replace github.com/google/uuid v1.1.1 => github.com/google/uuid v1.1.0</p><p>项目编译时就会从 GitHub 下载包。我们源代码中 import 路径 golang.org/x/text/xxx 不需要改变</p><p>场景三：调试依赖包
我们调试依赖包，就可以使用 replace 来修改依赖，如下所示：</p><p>replace (
github.com/google/uuid v1.1.1 => ../uuid
)</p><p>使用本地的 uuid 来替换依赖包，此时，我们可以任意地修改 …/uuid 目录的内容来进行调试。</p><p>除了使用相对路径，还可以使用绝对路径，甚至还可以使用自已的 fork 仓库。</p><p>场景四：禁止被依赖
另一种使用 replace 的场景是你的 module 不希望被直接引用，比如开源软件 kubernetes，在它的 go.mod 中 require 部分有大量的 v0.0.0 依赖，比如：</p><p>module k8s.io/kubernetes</p><p>require (
&mldr;
k8s.io/api v0.0.0
k8s.io/apiextensions-apiserver v0.0.0
k8s.io/apimachinery v0.0.0
&mldr;
)</p><p>由于上面的依赖都不存在 v0.0.0 版本，所以其他项目直接依赖 k8s.io/kubernetes 时会因无法找到版本而无法使用。</p><p>因为 Kubernetes 不希望作为 module 被直接使用，其他项目可以使用 kubernetes 其他子组件。kubernetes 对外隐藏了依赖版本号，其真实的依赖通过 replace 指定：</p><p>replace (
k8s.io/api => ./staging/src/k8s.io/api
k8s.io/apiextensions-apiserver => ./staging/src/k8s.io/apiextensions-apiserver
k8s.io/apimachinery => ./staging/src/k8s.io/apimachinery
&mldr;
)</p><p>go.sum 文件
我们发现，在 go.mod 下还会生成个 go.sum 文件</p><p>用途
下载依赖包有可能被恶意篡改，以及缓存在本地的依赖包也有被篡改的可能，单单一个 go.mod 文件并不能保证一致性构建，Go 开发团队在引入 go.mod 的同时也引入了 go.sum 文件，用于记录每个依赖包的哈希值（SHA-256 算法），在 build 时，如果本地的依赖包 hash 值与 go.sum 文件中记录得不一致，则会拒绝 build。</p><p>示例：格式[/go.mod]</p><p>github.com/google/uuid v1.0.0 h1:b4Gk+7WdP/d3HZH8EJsZpvV7EtDOgaZLtnaNGIu1adA=
github.com/google/uuid v1.0.0/go.mod h1:TIyPZe4MgqvfeYDBFedMoGGpEw/LqOeaOT+nhxU+yHo=</p><p>正常情况下，每个依赖包版本会包含两条记录，第一条记录为该依赖包版本整体（所有文件）的哈希值，第二条记录仅表示该依赖包版本中 go.mod 文件的哈希值，如果该依赖包版本没有 go.mod 文件，则只有第一条记录</p><p>go.sum 生成过程
在项目的根目录中执行 go get 命令的话，go get 会同步更新 go.mod 和 go.sum 文件，go.mod 中记录的是依赖名及其版本，如：</p><p>go.sum 文件中则会记录依赖包的哈希值（同时还有依赖包中 go.mod 的哈希值）</p><p>在更新 go.sum 之前，为了确保下载的依赖包是真实可靠的，go 命令在下载完依赖包后还会查询 GOSUMDB 环境变量所指示的服务器，以得到一个权威的依赖包版本哈希值。如果 go 命令计算出的依赖包版本哈希值与 GOSUMDB 服务器给出的哈希值不一致，go 命令将拒绝向下执行，也不会更新 go.sum 文件。</p><p>go mod tidy
拉取缺少的模块，移除不用的模块</p><p>go mod vendor
将 GOPATH/src/pkg/mod 中的缓存包，复制到项目的 vendor 目录中，即使用每个项目使用自身包的模式，类似之前的 govendor 管理方式</p><p>尽管如此，默认情况下，go build 将忽略该目录的内容。如果想从 vendor/ 目录中建立依赖关系，需要如下参数 build</p><p>go build -mod vendor</p><p>go mod download
下载依赖包</p><p>go mod edit
编辑 go.mod 文件一般直接用 ide 编辑就行</p><p>go mod graph
打印模块依赖图</p><p>go mod verify
验证依赖是否正确</p><p>go mod why
解释为什么需要依赖</p><p>补充与说明
关于自己发布包
go get 命令使用的版本是 git 中的 tag，我们制作包的时候也应该创建合适的 tag，例如</p><p>git tag v1.0.0
git push &ndash;tags</p><p>此时一个最佳实践是同时创建新分支 v1，以便后面我们修复错误和更新：</p><p>git checkout -b v1
git push -u origin v1</p><p>现在，我们可以使用 master 而不必担心破坏我们的版本。</p><p>接下来在 v1 分支中做修改，并将其标记为新版本。</p><p>git commit -m &ldquo;修改&rdquo;
git tag v1.0.1
git push &ndash;tags origin v1</p><p>始终要保持在 v1 分支中修改，这个分支是始终的进行兼容更新的，如果有大的不兼容的改版，要新建并切换分支 v2，发布新的路径。</p><p>模块的使用与更新
我们可以在写代码的时候先写好导入的包等，之后初始化 go mod 模式，go build 或者 go mod tidy 等命令，会自动下载相关导入</p><p>小版本更新
go get -u 会更新最新的小版本，举个例子，它会将 1.0.0 更新为 1.0.1 或者 1.1.0 这样类似的版本。go get -u=patch 来获取最新的 patch 更新。 举个例子，它会更新到 1.0.1 而不是 1.1.0 版本。</p><p>例子总结：</p><p>由于我们的程序使用的是软件包的 1.0.0 版，并且我们刚刚创建了 1.0.1 版，以下任何 命令都会将我们更新到 1.0.1 版:</p><p>go get -u
go get -u=patch
go get <a href=mailto:github.com/robteix/testmod@v1.0.1>github.com/robteix/testmod@v1.0.1</a></p><p>大版本更新
根据语义版本语义，大版本不同于小版本。大版本会破坏向后兼容性。从 Go 模块的角度来看，大版本是一个完全不同的包。一个库的两个不兼容的版本，实质上是两个不同的库。其余的和以前一样，我们推它，把它标记为 v2.0.0 (并可选地创建一个 v2 分支。)</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2021-03-20</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/2021/03/go_module/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://www.jesse233.top/2021/03/go_module/ data-title=Go_module><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://www.jesse233.top/2021/03/go_module/><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://www.jesse233.top/2021/03/go_module/ data-title=Go_module data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://www.jesse233.top/2021/03/go_module/ data-title=Go_module><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://www.jesse233.top/2021/03/go_module/ data-title=Go_module><i class="fab fa-weibo fa-fw"></i></a><a href=javascript:void(0); title="分享到 Myspace" data-sharer=myspace data-url=https://www.jesse233.top/2021/03/go_module/ data-title=Go_module data-description><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/myspace.svg></i></a><a href=javascript:void(0); title="分享到 Blogger" data-sharer=blogger data-url=https://www.jesse233.top/2021/03/go_module/ data-title=Go_module data-description><i class="fab fa-blogger fa-fw"></i></a><a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://www.jesse233.top/2021/03/go_module/ data-title=Go_module><i class="fab fa-evernote fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2021/03/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/ class=prev rel=prev title=深度学习从入门到精通><i class="fas fa-angle-left fa-fw"></i>深度学习从入门到精通</a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.81.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020 - 2021</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/jesse996 target=_blank>Jesse</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp><a href=https://beian.miit.gov.cn/>鄂ICP备20000568号-2</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js></script><script type=text/javascript src=/baidu.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:30},comment:{valine:{appId:"INI3WoInvuBqDhbYssM5bN7F-gzGzoHsz",appKey:"JMKzYaRNR5ck0aapOYkC8yHS",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!0,highlight:!0,lang:"zh-cn",pageSize:10,placeholder:"你的评论 ...",recordIP:!0,visitor:!0}},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-97TKQKDH9W')</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-97TKQKDH9W" async></script></body></html>