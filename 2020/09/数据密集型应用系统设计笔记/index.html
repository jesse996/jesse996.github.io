<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>数据密集型应用系统设计笔记 - Jesse's Blog</title><meta name=Description content="Jesse的博客"><meta property="og:title"content="数据密集型应用系统设计笔记"><meta property="og:description"content="第一章 可靠、可扩展与可维护的应用系统 可靠性 指即使发生故障，系统也可以正常运行。 可扩展性 指负载增加时，有效保持系统性能的相关技术策略。 可维护性"><meta property="og:type"content="article"><meta property="og:url"content="https://www.jesse233.top/2020/09/%E6%95%B0%E6%8D%AE%E5%AF%86%E9%9B%86%E5%9E%8B%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E7%AC%94%E8%AE%B0/"><meta property="og:image"content="https://www.jesse233.top/avatar.png"><meta property="article:published_time"content="2020-09-29T20:22:07+08:00"><meta property="article:modified_time"content="2020-09-29T20:22:07+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.jesse233.top/avatar.png"><meta name=twitter:title content="数据密集型应用系统设计笔记"><meta name=twitter:description content="第一章 可靠、可扩展与可维护的应用系统 可靠性 指即使发生故障，系统也可以正常运行。 可扩展性 指负载增加时，有效保持系统性能的相关技术策略。 可维护性"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=/favicon.svg><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.jesse233.top/2020/09/%E6%95%B0%E6%8D%AE%E5%AF%86%E9%9B%86%E5%9E%8B%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E7%AC%94%E8%AE%B0/><link rel=prev href=https://www.jesse233.top/2020/09/mybatis3%E6%BA%90%E7%A0%81%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E7%AC%94%E8%AE%B0/><link rel=next href=https://www.jesse233.top/2020/10/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAmysql%E7%AC%94%E8%AE%B0/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><meta name=baidu-site-verification content="yJZ8DYA9pA"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"数据密集型应用系统设计笔记","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.jesse233.top\/2020\/09\/%E6%95%B0%E6%8D%AE%E5%AF%86%E9%9B%86%E5%9E%8B%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E7%AC%94%E8%AE%B0\/"},"genre":"posts","wordcount":7418,"url":"https:\/\/www.jesse233.top\/2020\/09\/%E6%95%B0%E6%8D%AE%E5%AF%86%E9%9B%86%E5%9E%8B%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E7%AC%94%E8%AE%B0\/","datePublished":"2020-09-29T20:22:07+08:00","dateModified":"2020-09-29T20:22:07+08:00","publisher":{"@type":"Organization","name":"宋志新"},"author":{"@type":"Person","name":"Jesse"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Jesse's Blog"><img class="lazyload logo"src=/svg/loading.min.svg data-src=/favicon.svg data-srcset="/favicon.svg, /favicon.svg 1.5x, /favicon.svg 2x"data-sizes=auto alt=/favicon.svg title=/favicon.svg>Jesse's Blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/books>书单 </a><a class=menu-item href=/leetcode>LeetCode </a><a class=menu-item href=/about>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search"id=search-desktop><input type=text placeholder id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle"id=search-toggle-desktop title><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear"id=search-clear-desktop title><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading"id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span></span><a href=javascript:void(0); class="menu-item theme-switch"title><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Jesse's Blog"><img class="lazyload logo"src=/svg/loading.min.svg data-src=/favicon.svg data-srcset="/favicon.svg, /favicon.svg 1.5x, /favicon.svg 2x"data-sizes=auto alt=/favicon.svg title=/favicon.svg>Jesse's Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile"id=search-mobile><input type=text placeholder id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle"id=search-toggle-mobile title><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear"id=search-clear-mobile title><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading"id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile></a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/books title>书单</a><a class=menu-item href=/leetcode title>LeetCode</a><a class=menu-item href=/about title>关于</a><a href=javascript:void(0); class="menu-item theme-switch"title>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title></h2><div class="toc-content always-active"id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">数据密集型应用系统设计笔记</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/jesse996 title=Author target=_blank rel="noopener noreffer author"class=author><i class="fas fa-user-circle fa-fw"></i>Jesse</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2020-09-29>2020-09-29</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;&nbsp;<span id=/2020/09/%E6%95%B0%E6%8D%AE%E5%AF%86%E9%9B%86%E5%9E%8B%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E7%AC%94%E8%AE%B0/ class=leancloud_visitors data-flag-title=数据密集型应用系统设计笔记>
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;
</span>&nbsp;</div></div><div class="details toc"id=toc-static kept><div class="details-summary toc-title"><span></span><span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content"id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#第一章-可靠可扩展与可维护的应用系统>第一章 可靠、可扩展与可维护的应用系统</a><ul><li><a href=#可靠性>可靠性</a></li><li><a href=#可扩展性>可扩展性</a></li><li><a href=#可维护性>可维护性</a></li></ul></li><li><a href=#第二章-数据模型与查询语言>第二章 数据模型与查询语言</a><ul><li><a href=#datalog-基础>Datalog 基础</a></li></ul></li><li><a href=#第三章-数据存储于检索>第三章 数据存储于检索</a><ul><li><a href=#哈希索引>哈希索引</a><ul><li><a href=#文件格式>文件格式</a></li><li><a href=#删除记录>删除记录</a></li><li><a href=#崩溃恢复>崩溃恢复</a></li><li><a href=#部分写入的记录>部分写入的记录</a></li><li><a href=#并发控制>并发控制</a></li><li><a href=#哈希表索引也有其局限>哈希表索引也有其局限</a></li></ul></li><li><a href=#sstable-和-lsm-tree>SSTable 和 LSM-Tree</a></li><li><a href=#构建和维护-sstable>构建和维护 SSTable</a></li><li><a href=#性能优化>性能优化</a></li><li><a href=#b-trees>B-trees</a><ul><li><a href=#优化-b-tree>优化 B-tree</a></li><li><a href=#lsm-tree-优点>LSM-tree 优点</a></li><li><a href=#lsm-tree-缺点>LSM-tree 缺点</a></li><li><a href=#在索引中存储值>在索引中存储值</a></li></ul></li><li><a href=#星型与雪花型分析模式>星型与雪花型分析模式</a></li><li><a href=#列式存储>列式存储</a><ul><li><a href=#列压缩>列压缩</a></li></ul></li></ul></li><li><a href=#第四章-数据编码与演化>第四章 数据编码与演化</a><ul><li><a href=#json>JSON</a></li><li><a href=#二进制编码>二进制编码</a><ul><li><a href=#thrift-和-protocol-buffers>Thrift 和 Protocol Buffers</a></li><li><a href=#avro>Avro</a></li></ul></li><li><a href=#数据流的几种模型>数据流的几种模型</a></li></ul></li><li><a href=#第五章-数据复制>第五章 数据复制</a><ul><li><a href=#主从复制>主从复制</a></li><li><a href=#多主节点复制>多主节点复制</a></li><li><a href=#无主节点复制>无主节点复制</a></li><li><a href=#一致性模型>一致性模型</a></li></ul></li><li><a href=#第六章-数据分区>第六章 数据分区</a></li><li><a href=#第七章-事务>第七章 事务</a><ul><li><a href=#acid>ACID</a></li><li><a href=#脏读幻读不可重复读的概念>脏读、幻读、不可重复读的概念</a><ul><li><a href=#脏读>脏读</a></li><li><a href=#幻读>幻读</a></li><li><a href=#不可重复读>不可重复读</a></li></ul></li><li><a href=#弱隔离级别>弱隔离级别</a><ul><li><a href=#读-提交>读-提交</a><ul><li><a href=#读-提交实现>读-提交实现</a></li></ul></li><li><a href=#快照级别隔离与可重复读>快照级别隔离与可重复读</a><ul><li><a href=#实现快照级别隔离>实现快照级别隔离</a></li><li><a href=#一致性快照的可见性规则>一致性快照的可见性规则</a></li></ul></li></ul></li><li><a href=#防止更新丢失>防止更新丢失</a><ul><li><a href=#原子写操作>原子写操作</a></li><li><a href=#显示加锁>显示加锁</a></li><li><a href=#自动检测更新丢失>自动检测更新丢失</a></li></ul></li><li><a href=#写倾斜和幻读>写倾斜和幻读</a><ul><li><a href=#定义写倾斜>定义写倾斜</a></li></ul></li><li><a href=#串行化>串行化</a><ul><li><a href=#两阶段加锁2pl>两阶段加锁（2PL）</a></li><li><a href=#2pl-实现>2PL 实现</a></li></ul></li><li><a href=#可串行化的快照隔离级别>可串行化的快照隔离级别</a></li></ul></li><li><a href=#第八章-分布式系统的挑战>第八章 分布式系统的挑战</a></li><li><a href=#第九章-一致性共识>第九章 一致性共识</a><ul><li><a href=#可线性化>可线性化</a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=第一章-可靠可扩展与可维护的应用系统>第一章 可靠、可扩展与可维护的应用系统</h2><h3 id=可靠性>可靠性</h3><p>指即使发生故障，系统也可以正常运行。</p><h3 id=可扩展性>可扩展性</h3><p>指负载增加时，有效保持系统性能的相关技术策略。</p><h3 id=可维护性>可维护性</h3><p>意味着很多方面，本质是为了让工程和运营团队更为轻松。</p><h2 id=第二章-数据模型与查询语言>第二章 数据模型与查询语言</h2><p>读时模式：数据的结构时隐形的，只在读取时才解释。NoSQL。</p><p>写时模式：关系型数据库的一种传统方法，模式时显式的，并且数据库确保数据写入时都必须遵循。</p><p>读时模式类似动态类型检查，写时模式类似静态类型检查。</p><p>对文档进行更新时，通常会更新整个文档，而只有修改量不改变源文档大小时，原地覆盖更新才有效。因此，通常建议文档应该尽量小且避免写入时增加文档大小。</p><p>SQL 是一种声明式查询语言。CSS 也是声明式语言。</p><p>多对多关系是不同数据结构之间重要区别特征。如果数据大多是一对多关系或者记录之间没有关系，那么文档模型是合适的。</p><p>关系模型能够处理简单的多对多关系，但是随着数据之间的关联越来越复杂，将数据模型转换为图模型会更加自然</p><p>图由两种对象组成：顶点和边。</p><p>图强大的用途在于，提供了单个数据存储区保存完全不同类型对象的一致性方式。（顶点之间为不同类型，边之间为不同类型）</p><p>可以将图存储看作由两个关系表组成，一个用于定点，一个用于边。</p><p>Cypher 查询语言：一种用于属性图的声明式查询语言</p><p>如果把图数据放在关系结构中，也可以用 SQL 查询，只是存在一些困难。</p><p>三元存储模式几乎等同于属性图模型。<br>在三元存储中，所有信息都是以非常简单的三部分形式存储（主体，谓语，客体）。主体相当于图中顶点，而客体是以下两种之一：</p><ol><li>原始数据类型中的值，如字符串或数字。这种情况下，谓语和客体相当于键和值。</li><li>图中另一个顶点。此时，谓语是途中的边，主体是尾部顶点，客体是头部顶点。</li></ol><p>SPARQL 查询语言：采用 RDF 数据模型的三元存储查询语言。它比 Cypher 更早，并且由于 Cypher 的模式匹配是借用 SPARQL 的，所以二者看起来很相似。</p><p>图数据库和网络模型的比较：</p><ul><li>在 CODASYL 中，数据库有一个模式来指定哪种记录类型可以嵌套在其他记录类型中。在图数据库中则没有这种限制。</li><li>在 CODASYL 中，获取特定记录的唯一方法时遍历其中一条访问路径。在图数据库中，则可以通过顶点的唯一 ID 直接引用该顶点，也可以使用索引查找满足特定值的那些顶点。</li><li>在 CODASYL 中，记录的子记录是有序的，而图数据库中，顶点和边不是有序的。</li><li>在 CODASYL 中，所有的查询都是命令式的，图数据库可以用命令式，也可以用声明式，如 Cypher 和 SPARQL</li></ul><h3 id=datalog-基础>Datalog 基础</h3><p>Datalog 是比 SPARQL 和 Cypher 更古老的语言。Datalog 的数据模型类似于三元存储模式，但更为通用一些。它采用<code>谓语（主体，客体）</code></p><h2 id=第三章-数据存储于检索>第三章 数据存储于检索</h2><p>首先实现一个简单的文本键值对数据库。</p><p>许多数据库内部都使用日志，日志是一个仅支持追加更新的数据文件。</p><p><em>日志通常指的是应用程序的运行输出日志，来记录发生了什么事。这里则是一个更为通用的含义，表示一个仅能追加的记录序列集合，它可能是人类不可读的，可能是二进制格式的而只能被其他程序来读取。</em></p><p>如果日志保存了大量的记录，那个读性能会很慢。查找开销是 O(n)。</p><p>为了高效查找，引入了索引。但这会降低写的速度，所以需要权衡。</p><h3 id=哈希索引>哈希索引</h3><p>保存内存中的 hashmap，每当在文件中追加新的键值对时，还要更新 hashmap 来反映刚刚写入的数据的偏移。</p><p>只追加到一个文件，如何避免最终用尽磁盘空间？<br>一个好的方法是将日志分解成一定大小的段，当文件达到一定大小时就关闭它，并将后续写入到新的段文件中。然后可以再这些段上执行压缩。压缩意味着丢弃重复的键，只保留最近的键。</p><p>可以再执行压缩的同时将多个段合并在一起。由于段在写入后不会再进行修改，合并的段会被写入到另一个文件。</p><p>在压缩和合并时，继续用旧的段文件读取和写入。合并完成后，删除旧的段文件。</p><p>每个段都有自己的哈希表。先检查最新段的 hashmap，如果不存在，检查第二新的，以此类推。</p><h4 id=文件格式>文件格式</h4><p>CSV 不是日志的最佳格式。更快更简单的方法时使用二进制格式。首先以字节为单位记录字符串的长度，之后跟上原始字符串（不需要转义）</p><h4 id=删除记录>删除记录</h4><p>在数据文件中追加一个特殊的删除记录（墓碑），之后在合并段阶段删除。</p><h4 id=崩溃恢复>崩溃恢复</h4><p>将 hashmap 的快照存储在磁盘上</p><h4 id=部分写入的记录>部分写入的记录</h4><p>文件包含校验值</p><h4 id=并发控制>并发控制</h4><p>只有一个写线程，多个读线程</p><hr><h4 id=哈希表索引也有其局限>哈希表索引也有其局限</h4><ul><li>哈希表必须全部放入内存，如果有大量的 key，就没那么幸运了</li><li>区间查询效率不高</li></ul><h3 id=sstable-和-lsm-tree>SSTable 和 LSM-Tree</h3><p>如果要求键值对的顺序按键排序，这种格式称为排序字符串表，即 SSTable。</p><p>相比于哈希表索引日志段，有以下优点：</p><ol><li>合并段更加简单高效。因为是有序的，可以用类似合并排序算法。当多个段包含相同的键时，保留最新段的值。</li><li>不再需要在内存中保存所有键的索引。因为是有序的，可以对于段文件中的每几千字节，保存一个键就够了。稀疏的索引</li><li>由于读请求往往需要扫描请求范围内的多个键值对，可以考虑将这些记录保存到一个块中并在写磁盘之前将其压缩。然后稀疏内存索引的一个条目指向压缩块的开头。</li></ol><h3 id=构建和维护-sstable>构建和维护 SSTable</h3><p>存储引擎的基本工作流程如下：</p><ul><li>当写入时，将其添加到内存中的平衡树数据结构中（如红黑树）。这个内存中的树有时被称为内存表。</li><li>当内存表大于某个阈值（通常为几兆字节）时，将其作为 SSTable 文件写入磁盘。写入的同时可以继续添加到一个新的内存表</li><li>为了处理读请求，首先尝试在内存表中查找键，然后是最新的磁盘段文件，然后是次新，直到找到目标</li><li>后台进程周期性的执行合并与压缩过程，以合并多个段文件，并丢弃那些已被覆盖或删除的值</li></ul><p>基于合并和压缩排序文件原理的存储引擎通常都被称为 LSM 存储引擎。</p><h3 id=性能优化>性能优化</h3><p>当查找数据库中某个不存在的键时，LSM-Tree 算法可能很慢。为优化这种访问，使用额外的布隆过滤器。布隆过滤器是内存高效的数据结构，用于近似计算集合的内容。如果数据库中不存在某个键，它能很快告诉你结果，从而节省不必要的磁盘读取。</p><p>有不同策略，会影响甚至决定 SSTable 压缩和合并时的具体顺序和时机，最常见的有两种：</p><ul><li>大小分级：较新和较小的 SSTable 被连续合并到较旧和较大的 SSTable</li><li>分层压缩：键的范围分裂成多个更小的 SSTable，旧数据被移动到单独的“层级”，这样压缩可以逐步进行并节省磁盘空间</li></ul><h3 id=b-trees>B-trees</h3><p>它是几乎所有关系型数据库中的标准索引实现，许多非关系型数据库也经常使用。</p><p>同 SSTable 一样，B-tree 保留按键排序的键值对。B-tree 将数据库分解成固定大小的块或页，传统上大小为 4KB（有时更大），页是内部读写最小单位。磁盘也是以固定大小的块排列。</p><p>么个页面都用地址或位置进行标识，可以让一个页面引用另一个页面，类似指针，不过指向是磁盘地址，而不是内存。</p><p>一个页包含的子叶数量称为分支因子，通常有几百个。</p><p>B-tree 底层的基本写操作时使用新数据覆盖磁盘页上吗旧页。它假设覆盖不会改变页的磁盘存储位置，这与日志文件索引（如 LSM-Tree）仅追加更新文件形成鲜明对比</p><p>某些操作需要覆盖多个不同的页。例如，如果插入导致页溢出，因而需分裂页，那么需要写两个分裂的页，并且覆盖其父页以更新对两个子页的引用</p><p>为了能使数据库能从崩溃中恢复，常见的 B-tree 的实现需要支持磁盘上的额外的数据结构：预写日志（write-ahead log,WAL），也称重做日志。仅支持追加的文件，先更新 WAL 再修改树本身。</p><h4 id=优化-b-tree>优化 B-tree</h4><ul><li><p>一些数据库不使用覆盖页和维护 WAL 来进行崩溃恢复，而是使用写时复制方案。修改的页被写入不同的位置，树中父页的新版本被创建，并指向新的位置。</p></li><li><p>保存键的缩略信息。</p></li><li><p>相邻子页按顺序保存在磁盘上</p></li><li><p>添加额外的指针到树种。例如每个叶子页面可能会向左或向右引用其同级的兄弟页，这样可以顺序扫描键，而不用跳回到父页。</p></li></ul><h4 id=lsm-tree-优点>LSM-tree 优点</h4><ul><li>有较低的写放大，能承受更高的写入吞吐量</li><li>更好的压缩，因此通常磁盘上的文件比 B-tree 小很多</li></ul><h4 id=lsm-tree-缺点>LSM-tree 缺点</h4><ul><li>压缩过程会干扰正在进行的读写操作，容易发生读写请求等待的情况。而 B-tree 的响应延时则更具确定性。</li><li>磁盘的有限写入带宽需要在初始写入和后台运行的压缩线程之间所共享，可能会发生压缩无法匹配写入速率的情况，这种情况下，磁盘上未合并段的数量不断增加，导致磁盘空间不足。</li></ul><h4 id=在索引中存储值>在索引中存储值</h4><p>索引中的键时查询搜索的对象，而值是以下两类之一：</p><ol><li>实际行（文档，顶点）</li><li>对其他地方存储的行的引用。</li></ol><p>第二种情况下，存储行的具体位置被称为堆文件，它不以特定的顺序存储数据。</p><p>聚集索引：将索引行直接存储在索引中。mysql 的 InnoDB 存储引擎中，表的主键始终是聚集索引，二级索引引用主键，而不是堆文件位置。</p><p>覆盖索引：支持只通过索引回答某些简单的查询，包含一部分列。</p><p>级联索引：将一列追加到另一列，将几个简单的字段组合成一个键，例如<code>lastname,firstname</code>组成和<code>lastname-firstname</code>，由于排列，索引可以用于找特定<code>lastname</code>的人，或特定<code>lastname-firstname</code>的人，而不能找特定<code>firstname</code>的人。</p><p>OLTP：在线事务处理。根据用户的输入插入或更新记录。
OLAP：在线分析处理。数据分析，需要扫描大量的行，每个记录只读取少数几列，并计算汇总统计信息。</p><p>数据仓库包含公司所有 OLTP 系统的只读副本。从 OLTP 数据库中提取数据，转换为分析友好的模式，执行必要的清理，然后加载到数据仓库中。过程称为提取-转换-加载。</p><h3 id=星型与雪花型分析模式>星型与雪花型分析模式</h3><p>与 OLTP 使用了多种不同数据模型不同，分析型业务的数据模型要少很多。许多数据仓库使用星型模型，也称为维度建模。</p><p>“星型模式”来源自当表关系可视化时，事实表位于中间，被一系列维度表包围；这些表的链接就像星星的光芒。</p><p>该模式的一个变体称为雪花模式，其中维度进一步细分为子空间。</p><h3 id=列式存储>列式存储</h3><p>在大多数 OLTP 数据库中，存储以面向行的方式布局：来自表的一行的所有值彼此相邻存储。文档数据库也是类似。</p><p>面向列的存储的想法很简单：不需要讲一行中的所有值存储在一起，而是将每列中的所受值存储在一起。</p><h4 id=列压缩>列压缩</h4><p>用位图表示，位图也可以进行游程编码。</p><p>列存储的写操作时用 LSM-tree。</p><p>####物化视图
缓存查询最常用的一些计数或总和。</p><p>在 SQL 中，视图（标准视图、虚拟视图）是基于 SQL 语句的结果集的可视化的表。</p><p>视图包含行和列，就像一个真实的表。视图中的字段就是来自一个或多个数据库中的真实的表中的字段。我们可以向视图添加 SQL 函数、WHERE 以及 JOIN 语句，我们也可以提交数据，就像这些来自于某个单一的表。</p><p>视图总是显示最近的数据。每当用户查询视图时，数据库引擎通过使用 SQL 语句来重建数据。</p><p>不同的是，物化视图是查询结果的实际副本，并被写到磁盘，而虚拟视图只是用于编写查询的快捷方式。</p><p>在 OLTP 中不长使用物化视图，而对于大量读密集的数据仓库，物化事务则更有意义。</p><h2 id=第四章-数据编码与演化>第四章 数据编码与演化</h2><p>为了使系统继续顺利运行，需要保持双向的兼容性：</p><ul><li>向后兼容
较新的代码可以读取由旧代码编写的数据</li><li>向前兼容
较旧的代码可以读取由较新代码编写的数据</li></ul><p>使用语言内置的编码方案通常不是个好主意。</p><h3 id=json>JSON</h3><ul><li>对处理大数字有问题，可以用数字加字符串一起来表示</li><li>对 Unicode 支持很好，但不支持二进制字符串，所以通常用 Base64 将二进制数据编码为文本来解决。数据大小增加了 33%</li><li>由可选的模式支持。</li></ul><h3 id=二进制编码>二进制编码</h3><h4 id=thrift-和-protocol-buffers>Thrift 和 Protocol Buffers</h4><p>Thrift 和 Protocol Buffers 是两种二进制编码库，相比于直接用 JSON 更省空间</p><p>每个字段由其标签号标识，并使用数据类型进行标识。</p><h4 id=avro>Avro</h4><p>Apache Avro 是另一种二进制编码格式，也使用模式来指定编码的数据结构，它有两种模式语言：Avro IDL 用于人工编辑，另一种基于 JSON 更易于机器读取。</p><p>Avro 模式中没有标签编号，编码是最紧凑的。编码数据中没有任何内容告诉你它是什么类型。解析二进制数据时，按照他们出现在模式中的顺序便利这些字段，然后直接采用模式告诉你的每个字段的数据类型。这意味着读取数据的代码使用与写入数据的代码完全相同的模式才可以正确解析数据。</p><p>编码时，它使用所知道的模式的任何版本 来编码数据，这被称为写模式。</p><p>解码时，它期望数据符合某个模式，即读模式。</p><p>Avro 的关键思想是写模式和读模式不必是完全一样的，它们只需要保持兼容。</p><p>为了保持兼容性，只能添加或删除具有默认值的字段。更改字段名称是向后兼容的，但不能向前兼容。</p><p>Avro 对动态生成的模式更友好</p><h3 id=数据流的几种模型>数据流的几种模型</h3><ul><li>数据库
写入数据库的进程对数据进行编码，读数据库的进程进行解码</li><li>RPC 和 REST API
客户端对请求进行编码，服务器对请求进行解码并对响应进行编码，客户端最终对响应解码</li><li>异步消息传递（使用消息代理或 Actor）
节点之间通过狐仙发送消息进行通信，信息由发送者编码并由接受者解码</li></ul><h2 id=第五章-数据复制>第五章 数据复制</h2><h3 id=主从复制>主从复制</h3><p>只有主节点能写，读可以在主或从节点。主节点先写，然后将日志或更改发送给从节点，完成复制。</p><p>复制分为同步复制和异步复制</p><h3 id=多主节点复制>多主节点复制</h3><p>系统存在多个主节点，每个都可以接受写请求，客户端将写请求发送到其中一个主节点上，由该主节点负责将数据更改事件同步到其他主节点和自己的从节点。</p><h3 id=无主节点复制>无主节点复制</h3><p>客户端将写请求发送到多个节点上，读取时从多个节点上并行读取，以此检测和纠正某些过期数据</p><h3 id=一致性模型>一致性模型</h3><ul><li>写后读一致性
保证用户总能看到自己提交的最新数据</li><li>单调读
用户在某个时间点读到数据后，保证此后不会出现比该时间更早的数据</li><li>前缀一致读
保证数据之间的因果关系，例如，总是以正确的顺序读取问题，然后看到回答</li></ul><h2 id=第六章-数据分区>第六章 数据分区</h2><p>两种主要的分区方法：</p><ul><li>基于关键字区间的分区。先对关键字进行排序，每个分区只负责一段包含最小到最大关键字范围的一段关键字。对关键字排序的优点是可以支持高效的区间查询，但是如果应用程序经常访问与排序一致的某段关键字，就会存在热点的风险。采用这种方法，当分区太大时，通常将其分裂为两个子区间，从而动态的再平衡分区</li><li>哈希分区。将哈希函数作用于每个关键字，每个分区负责一定范围的哈希值。这种方法打破了原关键字的顺序关系，它的区间查询效率比较低，但可以更均匀的分配负载。采用哈希分区时，通常事先创建好足够多（但固定数量）的分区，让每个节点承担多个分区，当添加或删除节点时将某些分区从一个节点迁移到另一个节点，也可以支持动态分区。</li></ul><p>二级索引也需要分区，有两种方法：</p><ul><li>基于文档来分区二级索引（本地索引）</li><li>基于词条来分区二级索引（全局索引）</li></ul><h2 id=第七章-事务>第七章 事务</h2><h3 id=acid>ACID</h3><ul><li><p>原子性：把多个写操作纳入一个原子事务，出现故障时，事物会终止，数据库丢弃或撤销局部完成的更改</p></li><li><p>一致性：对数据有特定的预期状态，任何数据更改必须满足这些状态约束。一致性更多是应用层的属性。</p></li><li><p>隔离行：并发执行的多个事物相互隔离，不能互相交叉，可串行化。</p></li><li><p>持久性：保证事物一旦提交成功，即使存在硬件故障或数据库崩溃，事物所写入的任何数据也不会消失。</p></li></ul><h3 id=脏读幻读不可重复读的概念>脏读、幻读、不可重复读的概念</h3><h4 id=脏读>脏读</h4><p>所谓脏读是指一个事务中访问到了另外一个事务未提交的数据</p><h4 id=幻读>幻读</h4><p>一个事务读取 2 次，得到的记录条数不一致。<br>在一个事务中的写入改变了另一个事务查询结果的现象，称为幻读。</p><h4 id=不可重复读>不可重复读</h4><p>一个事务读取同一条记录 2 次，得到的结果不一致</p><h3 id=弱隔离级别>弱隔离级别</h3><h4 id=读-提交>读-提交</h4><p>是最基本的事务隔离级别，只提供以下两个保证：</p><ol><li>读数据库时，只能看到已成功提交的数据（防止脏读）</li><li>写数据库时，只能覆盖已成功提交的数据（防止脏写）</li></ol><h5 id=读-提交实现>读-提交实现</h5><ul><li>防止脏写：用行级锁。</li><li>防止脏读：对于每个待更新的对象，数据库都会维护其旧值和当前持锁事务将要设置的新值两个版本。在事务提交前，所有其他读操作都读取旧值仅当写事务提交后，才会切换到读取新值。</li></ul><h4 id=快照级别隔离与可重复读>快照级别隔离与可重复读</h4><p>解决不可重复读。其总体想法是：每个事务都从数据库的一致性快照中读取，事务一开始看到的是最近提交的数据，即使数据随后可能被另一个事务更改，但保证每个事务都只能看到该特定时间点的旧数据。</p><h5 id=实现快照级别隔离>实现快照级别隔离</h5><p>通常采用写锁来防止脏写。但是读取不需要加锁。读操作不会阻止写操作，反之亦然。</p><p>考虑到多个正在进行的事务可能会在不同的时间点查看数据库状态，所以数据库保留了对象多个不同的提交版本，这种技术因此也被称为多版本并发控制（MVCC）</p><p>如果只是为了提供读-提交级别隔离，则只保留对象的两个版本就足够了。支持快照隔离级别的存储引擎往往直接采用 MVCC 来实现读-提交隔离。典型做法是，在读-提交级别下，对每一个不同的查询单独创建一个快照；而快照级别隔离则是使用一个快照来运行整个事务。</p><h5 id=一致性快照的可见性规则>一致性快照的可见性规则</h5><p>仅当以下两个条件都成立，则该数据对象对事务可见：</p><ul><li>事务开始的时刻，创建该对象的事务已经完成了提交。</li><li>对象没有被标记删除；或者被标记的删除，但删除事务在当前事务开始时还没有完成提交。</li></ul><h3 id=防止更新丢失>防止更新丢失</h3><h4 id=原子写操作>原子写操作</h4><p>例如，以下指令在多数关系型数据库中都是并发安全的：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>UPDATE</span> <span class=n>counters</span> <span class=k>SET</span> <span class=n>valie</span> <span class=o>=</span> <span class=n>value</span> <span class=o>+</span> <span class=mi>1</span> <span class=k>WHERE</span> <span class=k>key</span> <span class=o>=</span> <span class=s1>&#39;foo&#39;</span><span class=p>;</span>
</code></pre></td></tr></table></div></div><p>原子操作通常采用对读取对象加独占锁的方式来实现，这样在更新被提交之前不会让对其他事务可以读它。</p><h4 id=显示加锁>显示加锁</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>figures</span> <span class=k>WHERE</span> <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;robort&#39;</span> <span class=k>FOR</span> <span class=k>UPDATE</span><span class=p>;</span>
</code></pre></td></tr></table></div></div><p><code>FOR UPDATE</code>指令指示数据对返回的所有结果行要加锁</p><h4 id=自动检测更新丢失>自动检测更新丢失</h4><p>原子操作和锁都是通过强制“读-修改-写回”操作序列串执行来防止丢失更新。另一种思路是先让他们并发执行，但如果事务管理器检测到了更新丢失风险，则终止当前事务，并强制回退到安全的“读-修改-写回”方式。</p><h3 id=写倾斜和幻读>写倾斜和幻读</h3><h4 id=定义写倾斜>定义写倾斜</h4><p>如果两个事务读取相同的一组对象，然后更新其中的一部分：不同的事务更新不同的对象，则可能发生写倾斜；而不同的事务如果更新的是同一个对象，则可能发生脏写或更新丢失。</p><h3 id=串行化>串行化</h3><h4 id=两阶段加锁2pl>两阶段加锁（2PL）</h4><p>近三十年来，可以说数据库只有一种被广泛使用的串行化算法，那就是两阶段加锁。</p><p>多个事务可以同时读取同一个对象，但只要出现任何的写操作，则必须加以独占访问：</p><ul><li>如果事务 A 已经读取了某个对象，此时事务 B 想要写入该对象，那么 B 必须等到 A 提交或终止才能继续。以确保 B 不会在事务 A 执行的过程中间去修改对象。</li><li>如果事务 A 已经修改了对象，此时事务 B 想要读取该对象，则 B 必须等到 A 提或终止之后才能继续，对于 2PL，不会出现读取到旧值得情况。</li></ul><p>快照级别隔离的口号“读写互不干扰”非常准确的点名到了它和 2PL 的关键区别。</p><h4 id=2pl-实现>2PL 实现</h4><p>读取用共享锁，可以多个同时共享。写入要独占锁，此时不能有其他的独占锁和共享锁。就像 Rust 的可变引用和不可变引用的规则，</p><h3 id=可串行化的快照隔离级别>可串行化的快照隔离级别</h3><p>它提供了完整的可串行化保证，而性能相比于快照隔离损失很小。</p><p>2PL 是一种悲观控制机制，可串行化的快照隔离级别是一种乐观并发控制。运行多个事务并发执行互不阻塞；仅当事务尝试提交时，才检查可能的冲突，如果发现违背了串行化，则某些事务会被中止。</p><h2 id=第八章-分布式系统的挑战>第八章 分布式系统的挑战</h2><h2 id=第九章-一致性共识>第九章 一致性共识</h2><p>分布式一致性模型与我们之前讨论过的多种事务隔离级别有相似之处，但总体讲他们有着显著的区别：事务隔离主要是为了处理并发执行事务时的各种临界条件，而分布式一致性则主要是针对延迟和故障等问题来协调副本之间的状态。</p><h3 id=可线性化>可线性化</h3><p>数据库对上提供单个副本的假象，从而不必担心复制滞后。
这就是可线性化（也称原子一致性，强一致性）</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/2020/09/%E6%95%B0%E6%8D%AE%E5%AF%86%E9%9B%86%E5%9E%8B%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E7%AC%94%E8%AE%B0/index.md target=_blank></a></span></div><div class=post-info-share><span><a href=javascript:void(0); title=Twitter data-sharer=twitter data-url=https://www.jesse233.top/2020/09/%E6%95%B0%E6%8D%AE%E5%AF%86%E9%9B%86%E5%9E%8B%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E7%AC%94%E8%AE%B0/ data-title=数据密集型应用系统设计笔记><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title=Facebook data-sharer=facebook data-url=https://www.jesse233.top/2020/09/%E6%95%B0%E6%8D%AE%E5%AF%86%E9%9B%86%E5%9E%8B%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E7%AC%94%E8%AE%B0/><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title=WhatsApp data-sharer=whatsapp data-url=https://www.jesse233.top/2020/09/%E6%95%B0%E6%8D%AE%E5%AF%86%E9%9B%86%E5%9E%8B%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E7%AC%94%E8%AE%B0/ data-title=数据密集型应用系统设计笔记 data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=javascript:void(0); title=Line data-sharer=line data-url=https://www.jesse233.top/2020/09/%E6%95%B0%E6%8D%AE%E5%AF%86%E9%9B%86%E5%9E%8B%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E7%AC%94%E8%AE%B0/ data-title=数据密集型应用系统设计笔记><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg></i></a><a href=javascript:void(0); title=微博 data-sharer=weibo data-url=https://www.jesse233.top/2020/09/%E6%95%B0%E6%8D%AE%E5%AF%86%E9%9B%86%E5%9E%8B%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E7%AC%94%E8%AE%B0/ data-title=数据密集型应用系统设计笔记><i class="fab fa-weibo fa-fw"></i></a><a href=javascript:void(0); title=Myspace data-sharer=myspace data-url=https://www.jesse233.top/2020/09/%E6%95%B0%E6%8D%AE%E5%AF%86%E9%9B%86%E5%9E%8B%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E7%AC%94%E8%AE%B0/ data-title=数据密集型应用系统设计笔记 data-description><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/myspace.svg></i></a><a href=javascript:void(0); title=Blogger data-sharer=blogger data-url=https://www.jesse233.top/2020/09/%E6%95%B0%E6%8D%AE%E5%AF%86%E9%9B%86%E5%9E%8B%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E7%AC%94%E8%AE%B0/ data-title=数据密集型应用系统设计笔记 data-description><i class="fab fa-blogger fa-fw"></i></a><a href=javascript:void(0); title=Evernote data-sharer=evernote data-url=https://www.jesse233.top/2020/09/%E6%95%B0%E6%8D%AE%E5%AF%86%E9%9B%86%E5%9E%8B%E5%BA%94%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E7%AC%94%E8%AE%B0/ data-title=数据密集型应用系统设计笔记><i class="fab fa-evernote fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()></a></span>&nbsp;|&nbsp;<span><a href=/></a></span></section></div><div class=post-nav><a href=/2020/09/mybatis3%E6%BA%90%E7%A0%81%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E7%AC%94%E8%AE%B0/ class=prev rel=prev title=MyBatis3源码深度解析笔记><i class="fas fa-angle-left fa-fw"></i>MyBatis3源码深度解析笔记</a>
<a href=/2020/10/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAmysql%E7%AC%94%E8%AE%B0/ class=next rel=next title=深入浅出MySql笔记>深入浅出MySql笔记<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/jesse996 target=_blank>Jesse</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp>鄂ICP备20000568号</span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js></script><script type=text/javascript src=/baidu.js></script><script type=text/javascript>window.config={code:{copyTitle:"",maxShownLines:30},comment:{valine:{appId:"INI3WoInvuBqDhbYssM5bN7F-gzGzoHsz",appKey:"JMKzYaRNR5ck0aapOYkC8yHS",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!0,highlight:!0,lang:"",pageSize:10,placeholder:"",recordIP:!0,visitor:!0}},cookieconsent:{content:{dismiss:"",link:"",message:""},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-97TKQKDH9W')</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-97TKQKDH9W"async></script></body></html>