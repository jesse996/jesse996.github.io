# Elastic笔记


### 全文检索

是指在全文数据中检索单个文档或文档集合的搜索技术。

全文数据：像文章、网页、邮件这种全文本数据
文档：全文本数据中的一条数据

### 倒排索引

倒排索引先将文档中包含的关键字全部提取出来，然后将关键字与文档的对应关系保存起来，最后再对关键字本身做索引排序

### elasticsearch 索引

elasticsearch 中所有数据的检索都必须要通过倒排索引来检索。所以将文档的容器直接称为索引，这里的索引就是倒排索引，更准确的说是一组倒排索引。

### 分区

为了避免重新索引导致的严重性能开销，elasticsearch 对索引分片数量做了一个严格的限制，就是索引分片数量一旦在创建索引时确定后就不能再修改了。

但无论容量规划得多科学依然不能完全避免文档实际存储量与索引容量不想等的情况。唯一可行的情况就是创建新的索引，再将原索引中的文档存储到新索引中

### 索引别名

`_alias` 和`_aliases` 接口设置别名

`_rollover` 用于根据一系列条件将别名指向一个新的索引

### 索引配置

setting
索引关闭和打开
`_close` ,`_open`

### 动态字段

dynamic:

-   true 默认，支持动态增加新字段
-   false,新字段依然会被保存到文档中，只是这个字段的定义不会被添加到索引映射的字段字段定义中。

### 动态模板

用于自定义动态添加字段时的映射规则。通过索引映射类型的 dynamic_templates 参数设置

### 索引模板

在创建索引时默认为索引添加的别名，配置，和映射关系等。分别通过`index_patterns`,`aliases`,`setting`,`mapping`设置。可通过`_template接口创建`

### `_split` 接口

在新索引中将每个主分区分裂为两个或更多分区，所以分区数量都是成倍增加而不能逐个增加。分裂虽然会创建新的索引，但是新索引中的数据只是通过文件系统硬连接到新的索引中，所以不存在复制。分片又是在本地分裂，不存在网络传输，所以效率还是比较高的。
需要预先设置 number_of_routing_shards 参数

### `_shrink`接口

用于缩减索引分片

### `_reindex`接口

将文档从一个索引重新索引到另一个索引中。不会将原索引的配置信息复制到新索引中。必须将索引的`_source`字段开启

### `_refresh`接口

主动刷新一个或多个索引，将已经添加的文档编入索引使它们在检索时可见

### `_cache`接口

用于主动清理缓存，需要在`_cache`后附加关键字`clear`。

```
clear?query=true
clear?request=true
clear?fielddata=true&fields=notes
```

-   query:节点查询缓存，负责存储节点查询的结果。一个节点只有一个缓存，同一个节点上的分片共享一个缓存。默认开启。默认使用节点内存的 10%作为上线
-   request：分片请求缓存，负责存储分片接受到的查询结果。不会缓存查询结果的 hits 字段，也就是具体的文档内容，它一般 之缓存聚集查询的相关结结果。默认开启。
-   fielddata：将 text 类型字段提取到所有词项全部加载到内存中，以提高使用该字段做排序和聚集运算的效率。由于 fielddata 是 text 对文档值机制的替代，所以天然开启且无法关闭。

### `_stats`接口

查看运行状态

### `_shard_stores`和`_segments`接口

`_shard_stores`用于查询索引分片存储情况
`_segments`用于查看底层 Lucene 的分段情况

### 索引文档

将文档分析处理后编入索引以使文档可检索。

### 获取文档

-   获取单个文档
    如`GET /test/_doc/1`
-   获取多个文档
    如
    ```
    GET _mget
    {
        "docs":[
            "_index":"students",
            "_id":"1",
            "_source":{
                "include":["name"],
                "exclude":["gender"]
            }
        ]
    }
    ```

### 删除文档

-   根据 id
-   根据查询条件

### 更新文档

-   `_update`接口：用于解决更新文档单个字段的问题。困纯属 doc 参数指明要更新的字段。还可以用 scipt 参数设置更新脚本，一般用 Painless 语言
-   `_update_by_query`接口：根据查询条件更新

### 批量操作

`_bulk`接口：接受一族请求体，请求体一般分为两组，第一个代表操作文档的类型，第二个代表操作文档所需的参数。

